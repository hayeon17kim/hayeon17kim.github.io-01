# HTTP 캐싱

캐싱이란 이전에 가져온 리소스를 저장하고 요청할 때 서브하는 기술이다. 리소스를 회신하는 데 더 적은 비용이 든다.  웹사이트와 애플리케이션의 성능을 향상시킬 수 있다. 웹캐시는 리소스를 뿌리는 데 걸리는 시간을 줄여준다.

## 캐시의 종류

크게 사설 캐시와 공유 캐시로 나눠진다. 이 외에도 게이트웨이 캐시, CDN, 리버스 록시 캐시, 로드 밸런서 등이 있다.

### 사설 브라우저 캐시

- 단일 사용자에 초점을 맞춰져 있다.
- 브라우저 캐시: 사용자에 의해 HTTP를 통해 다운로드된 모든 문서들을 가지고 있다
- 서버에 대한 추가적인 요청 없이 뒤로 가기, 앞으로 가기, 저장, 소스로 보기 등을 위해 방문했던 문서들을 만드는 데 사용됨 

  

### 공유 캐시

- 한 명 이상의 사용자에 의해 재사용되는 응답을 저장하는 캐시
- ex) 웹프록시를 설치해 조회가 많이 되는 리소스들은 몇 번이고 재사용



## 캐싱 동작의 대상

- 주로 GET에 대한 응답을 캐싱

- 일차 캐시키

  - 요청 메서드
  - 대상 URI: 특히 GET요청으로만 사용되는 URI
  
- 캐싱 엔트리 폼

  - 검색 요청의 성공적인 결과
  - HTML 문서, 이미지, 파일과 같은 리소스를 포함하는 GET 요청에 대한 200(OK) **응답**
    - 영구적인 리다이렉트:301 응답 
    - 404: 결과 페이지 찾을 수 없음
    - 206: 부분적인 컨텐츠 응답 (완전하지 않은 결과)
    - 캐시 키로 사용하기에 적절한 무언가가 정의된 경우 GET 이외의 응답
  
  
  
## 캐싱 제어
### Cach-control 헤더

### 캐시하지 않음

- `Cache-Control: no-store`
- 클라이언트 요청 혹은 서버 응답에 대해 어떤 것도 저장하지 않는다.

### 캐시하지만 재검증

- 캐시된 복사본을 사용자에게 보여주기 전에, 재검증을 위해 원 서버로 요청을 보낸다.

- `Cache-Control: no-cache`
- `max-age: 0`과 비슷한 역할로, 



#### expiration

캐시를 언제까지 쓸 것인지, 캐시의 수명.

1년 동안 캐시를 사용하겠다라는 명령. 

from disk cache (네트웤을 사용하지 않았다 ) 디스크나 메모리를 가지고

좋은 점: 

- 사용자:d





캐시 문제점

- 신선도의 문제 : 수정을 했는데도 사용자가 이미 가지고 있는 리소스를 가져오기 때문에 반영이 되지 않는다. 

성능이 좋으면서도(빠름빠름) 신선도를 유지할 수 있는 방법은?

- max-age = 5 이런 식으로 하면 5초에 한번씩 서버에 접속해서 다운로드



#



  ## 유효함

### 활성화된 리소스



## 캐시 검증

### ETags





## 상황에 따른 응답







### Cache Control: maxAge

last-modified : 언제 수정되었는지 웹서버가 웹브라우저한테 알려줌

5초가 지나면 웹브라우저가 웹서버한테 "내가 갖고 있는 ~파일은 이 시간에 마지막으로 (last modified) 수정된 파일이야. 이후로 서버쪽에서 저 파일이 수정된 적이 있어? 있다면 전송해줘, 없다면 없다는 말만 해. 전송은 하지 말고."

"너가 갖고 있는 파일과 내가 갖고 잇는 파일의 마지막으로 수정 시간이 같으니까 수정된 게 없어. "

컨텐츠 자체는 전송하지 않고, 헤더만 주고받고 있다.

만약 수정 사항이 있다면 200 응답과 함께 리소스 전달 

=> 적당히 신선도 있게, 적당히 성능도 챙길 수 있음

요청

Cache Contol: no-cache

- 캐시를 저장하지 않는다는 의미가 아니라 maxAge:0 과 같음. 캐시가 유효한지를 항상 확인



ETag

- Last-Modified: 초까지만은 부정확함. 엄청 빨리 동작하기 때문에
- ETag: b0f-~: 이걸 캐시로서 저장. 
- 이 두개의 값을 주면( 서버가). 
- if modified since, if none match:둘중에 하나라도 값이 다르다면 파일을 보낸다. 조건에 따라서 다르게 동작하는 캐싱 시스템 



결정틀

- 리소스 다시 쓰리거니?
- 유효성 검사: 로컬에 가지고 있는거하고 서버 파일이 다른
- 브라우저 --> Caching Server < - > WebServer
  - 사용자에게 전달해야 하는 데이터가 보안을 요구하고 중간에 저장을 하면 안된다면 Private 을 주면 캐싱 서버가 저장하지 않음. Public 으로 주면 캐싱서버가 저장해서 속도를 향상시켜준다 (특히 거리가 멀 때 서버가 미국이고 브라우저가 한국일 때 사용한다.)

- 캐시의 수명 정할 수 있나?max-age..



- 성능을 향상시키고 귀한 인터넷 자원을 아낄 수 있는 핵심 기술 

- 캐싱을 테스팅할 수 있는 여러 도구가 있음 (개발자 도구, 서비스 등)
- offline application
- prograssive web application

- 네트워크가 끊겨도 할 수 있는 웹사이트? 그러나 캐시는 
  - application cache : 인터넷이 끊겨도 웹을 동작하게 할 수 있음 (마치 앱처럼)
  - 웹브라우저 측에서 동작하는 캐싱, 서버 측에서 동작하는 서버 (캐싱서버)
    - 캐시 데이터를 하드디스크같은 저장장치가 아니라 메모리에 저장해서 같은 페이지에 있으면 메모리에 있는 걸 가져옴 - 고속으로 컨텐츠 제공 -> 웹서버의 부담을 획기적으로 줄이고 빠르게.
    - 캐싱서버를 전세계에 놓으면? 네트워크 속도 죽임
    - 컨텐츠를 배달해주는 네트워크, CDN이라고도 한다. (content delivery network)
  - 