# HTTP 개요

Mozilla의 개발자를 위한 웹 기술 문서 중 HTTP 문서를 요약한 내용입니다. 낯선 용어가 많아서 핵심 용어 또한 함께 정리하였습니다.

## HTTP란?

- 웹에서 이루어지는 모든 데이터 교환의 기초
- 클라이언트-서버 프로토콜: 수신자 측에 의해 요청이 초기화되는 프로토콜
  - 요청: 클라이언트(브라우저)에 의해 전송되는 메시지
  - 응답: 서버에서 응답으로 전송되는 메시지
- 애플리케이션 계층의 프로토콜
- 확장 가능한 프로토콜



## HTTP 기반 시스템의 구성 요소

HTTP 기반 시스템의 구성 요소는 크게 **클라이언트(사용자 에이전트)**와 **웹 서버**, 그리고 그 중계자 역할을 하는 **프록시**로 구성된다. 물론 전송/네트워크 계층으로 들어가면 더 복잡한 요소들이 있지만, 여기에서는 **애플리케이션 계층**의 구성요소에 대해서만 정리하겠다.

 ### 클라이언트



### 웹 서버



### 프록시



- 클라이언트-서버 프로토콜
- 클라이언트: 사용자 에이전트
  - 요청을 보내는 개체
  - 사용자를 대신하여 동작하는 모든 도구(브라우저)
  - HTML문서 요청 가져옴 => 파일 구문분석 => 스크립트 및 CSS 요청 가져옴 => 리소스 혼합. (스크립트는 이후 더 많은 리소스를 가져올 수 있으며 브라우저는 그에 따라 웹 페이지 갱신)
- 서버: 클라이언트 요청에 대한 문서를 제공
- 프록시
  - 애플리케이션 계층에서 동작하는 것들 (전송, 네트워크, 물리 계층이 아님)
  - 다양한 기능 수행 가능 (캐싱, 필터링, 로드 밸런싱, 인증, 로깅)



## HTTP 기초

### 간단 (Simple)

HTTP 메시지를 프레임별로 캡슐화하여 간결함을 유지한 덕분에 사람이 읽고 이해할 수 있어 테스트하기 쉽습니다.

### 확장 가능 (Extensive)

HTTP 헤더를 통해 새로운 기능을 추가할 수 있습니다.

### 상태 없음 (Stateless) 

HTTP는 상태가 없는(Stateless) 프로토콜입니다. 클라이언트와의 첫 번째 통신에서 데이터를 주고 받았다고 해도, 두 번째 통신에서 이전 데이터를 유지하지 않습니다. 하지만, 실제로는 데이터 유지가 필요한 경우가 많습니다. 정보가 유지되자 않으면 매번 페이지를 이동할 때마다 로그인을 해야 하고, 상품을 선택하고도 구매 페이지에 선택한 상품이 없을 것입니다. 이때 쿠키는 상태가 있는 세션을 만들어 이러한 상황에 대처합니다.

### HTTP와 연결 (Connections)

HTTP의 연결은 신뢰할 수 있는 전송 프로토콜인 TCP에 기반합니다. 따라서 클라이언트와 서버가 HTTP를 요청/응답으로 교환하기 전에 TCP 연결을 설정해야 합니다. HTTP/1.0 때는 각 요청/응답에 대해 별도의 TCP 연결을 열었습니다. HTTP/1.1은 파이프라이닝과 지속적인 연결 개념을 도입해 이전 버전의 비효율성을 개선하고자 했습니다. 이후 HTTP/2는 단일 연결 상에서 메시지를 다중 전송(multiplex)하여 연결을 좀 더 지속적이고 효율적으로 유지하도록 하였습니다.



## HTTP로 제어할 수 있는 것

### 캐시

HTTP는 문서가 캐시되는 방식을 제어할 수 있습니다. 캐싱 기술은 리소스를 재사용하여 성능을 향상시켜줍니다.

- 서버: 캐시 대상과 기간을 프록시와 클라이언트에 지시 가능
- 클라이언트: 저장된 문서 무시하라고 중간 캐시 프록시에 지시 가능

###  origin 제약사항을 완화하기

- 스누핑과 프라이버시 침해를 막기 위해 브라우저에는 동일한 origin으로부터 온 페이지만이 웹 페이지의 전체 정보에 접근할 수 있다는 제약사항이 있다. 그러나 HTTP헤더를 통해 이러한 제약사항을 완화하여 다른 도메인으로부터 전달된 정보를 **패치워크**할 수 있다. 

### 인증

웹페이지를 보호하여 특정 사용자만이 접근할 수 있게 한다.

- HTTP를 통해 WWW-Authenticate 혹은 유사한 헤더를 사용
- HTTP쿠기를 사용해 특정 세션을 설정

### 프록시와 터널링

서버 혹은 클라이언트는 인트라넷에 위치하여 다른 개체들에게 실제 주소를 숨기기도 한다. 이때 HTTP 요청은 네트워크 장벽을 가로지르기 위해 프록시를 통해 나간다. 

### 세션

- HTTP는 기본적으로 상태 없는 프로토콜이지만 HTTP 쿠키는 세션을 만들어 서버 상태를 요청과 연결하도록 해준다. (ex: 쇼핑몰 바구니)



## HTTP 흐름

1. TCP 연결을 연다.

2. HTTP 메시지를 전송한다.

   ```
   GET / HTTP/1.1
   Host: developer.mozilla.org
   Accept-Language: fr
   ```

3. 서버에 의해 전송된 응답을 읽어들인다.

   ```
   HTTP/1.1 200 OK
   Date: Sat, 09 Oct 2010 14:28:02 GMT
   Server: Apache
   Last-Modified: Tue, 01 Dec 2009 20:18:22 GMT
   ETag: "51142bc1-7449-479b075b2891b"
   Accept-Ranges: bytes
   Content-Length: 29769
   Content-Type: text/html
   
   <!DOCTYPE html... (here comes the 29769 bytes of the requested web page)
   ```

4. 연결을 닫거나 다른 요청들을 위해 재사용한다. 



HTTP 파이프라이닝은 첫번째 응답을 완전히 수신할 때까지 기다리지 않고 여러 요청을 보내는 걸 가능하게 한다. 그러나 구현이 어려워 프레임 안에서 보다 활발한 다중 요청을 보내는  HTTP/2로 교체되고 있다.



## HTTP 메시지

### 요청

![HTTP 요청 메시지](https://mdn.mozillademos.org/files/13687/HTTP_Request.png)

- HTTP 메서드: GET, POST / OPTIONS, HEAD 
- 가져오려는 리소스의 경로
- HTTP 프로토콜의 버전
- 서버에 대한 추가 정보를 제공하는 선택적 헤더



### 응답

![HTTP 응답 메시지](https://mdn.mozillademos.org/files/13691/HTTP_Response.png)

- 프로토콜의 버전
- 상태 코드: 요청의 성공 여부와 그 이유
- 상태 메세지
- HTTP 헤더들



## HTTP 기반 API

- XMLHttpRequest API
- Fetch API
- 서버-전송 이벤트: 클라이언트는 EventSource 인터페이스를 사용하여, 연결을 맺고 이벤트 핸들러를 설정.  클라이언트 브라우저는 HTTP 스트림으로 도착한 메시지를 적절한 Event  객체로 자동 변환하여, 해당 이벤트 type에 대해 등록된 이벤트 핸들러로 전달하거나, 특정 유형의 이벤트가 설정되지 않은 경우에는 onmessage 이벤트 핸들러로 전달



## 결론

- HTTP: 사용 쉬운 확장 가능한 프로토콜
- 헤더를 쉽게 추가할 수 있는 능력을 지닌 클라이언트-서버 구조는 HTTP가 웹의 확장된 수용력과 함께 발전할 수 있게 함
- HTTP/2가 성능 향상을 위해 HTTP 메시지를 프레임 안으로 임베드하여 복잡함을 더하였지만 애플리케이션의 관점에서 볼 때 메시지의 구조는 이전과 동일하다.
- 세션의 흐름은 단순하며, 간단한 HTTP 메시지 모니터를 이용한 조사와 디버그를 가능하게 해준다.





## 용어 정리

### 프로토콜

통신 프로토콜(규약, Protocal)이란? 데이터를 주고 받는(통신) 상호 간에 이 과정을 원활하게 하도록 해주는 미리 약속된 규칙을 말한다. 사람과 사람이 통신할 때 서로 이해할 수 있는 언어를 사용해야 대화를 할 수 있는 것처럼, 컴퓨터와 컴퓨터 사이에도 프로토콜이 있어야 한다.



### 애플리케이션 계층

출처: https://the-brain-of-sic2.tistory.com/49

![nextwork layer](https://t1.daumcdn.net/cfile/tistory/260DEE4355B6808D26)

애플리케이션 계층을 이해하기 위해서는 네트워크 프로토콜 계층을 이해해야 한다. 인터넷의 복잡함과 거대한 구조로 인해 네트워크 설계자는 인터넷을 계층화하여 설계하였고, 이것이 네트워크 프로토콜 계층이다. 네트워크 계층에서 애플리케이션 계층은 위와 같이 최상위에 위치하고 있다.  HTTP는 애플리케이션 계층에 위치하고 있으며, TCP를 전송 계층으로 사용한다.

### 사용자 에이전트



### 프록시

출처: 위키백과 

![프록시](https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Open_proxy_h2g2bob.svg/350px-Open_proxy_h2g2bob.svg.png)

클라이언트가 자신을 통해서 다른 네트워크에 간접적으로 접근할 수 있게 해주는 컴퓨터 시스템이나 응용 프로그램을 가리킨다. 서버와 클라이언트 사이에 중계기로서 대리로 통신을 수행하는 것을 '프록시', 그 중계 기능을 하는 것을 프록시 서버라고 한다. 프록시 서버 중 일부는 프록시 서버에 요청된 내용을 캐시를 이용해서 저장해둔다. 이후에 캐시 안에 있는 정보를 요구하는 요청에 대해서는 원격 서버에 접속해서 데이터를 가져올 필요가 없게 되었다. 이로 인해 전송 시간을 절약, 불필요한 외부와의 연결 방지, 이로 인한 외부와의 트래픽 감소로 네트워크 병목 현상 방지라는 장점이 있다. 웹 페이지를 캐시로 저장하는 데 흔히 쓰이지만 이 외에도 많은 기능을 수행한다. (익명으로 컴퓨터 유지, 원하지 않는 사이트 차단, 사용률 기록 및 검사 등)



### 세션

세션은 

